# 第15章：字符串操作

Pandas提供了强大的字符串处理功能，通过`.str`访问器可以进行各种字符串操作。本章将详细介绍字符串处理的技巧。

## 15.1 基础字符串操作

```python
import pandas as pd
import numpy as np

# 创建字符串数据
s = pd.Series(['  Hello  ', 'WORLD', 'Pandas', 'data analysis'])

print("原始数据：")
print(s)

# 大小写转换
print("\n大写：", s.str.upper().values)
print("小写：", s.str.lower().values)
print("首字母大写：", s.str.capitalize().values)
print("标题格式：", s.str.title().values)

# 去除空白
print("\n去除空白：", s.str.strip().values)

# 替换
print("\n替换：", s.str.replace('a', 'A').values)

# 字符串包含
print("\n包含'an'：", s.str.contains('an').values)
```

## 15.2 字符串分割和连接

```python
# 分割
emails = pd.Series(['user1@example.com', 'user2@example.com', 'user3@example.com'])
print("邮箱地址：")
print(emails)

# 分割成多列
split_df = emails.str.split('@', expand=True)
split_df.columns = ['Username', 'Domain']
print("\n分割后：")
print(split_df)

# 连接
names = pd.Series([['John', 'Doe'], ['Jane', 'Smith'], ['Bob', 'Johnson']])
print("\n连接姓名：")
print(names.str.join(' ').values)

# 字符串拼接
s1 = pd.Series(['Hello', 'Good', 'Happy'])
s2 = pd.Series(['World', 'Morning', 'Day'])
print("\n字符串拼接：")
print((s1 + ' ' + s2).values)
```

## 15.3 正则表达式

```python
# 创建数据
texts = pd.Series([
    'Phone: 138-1234-5678',
    'Phone: 139-8765-4321',
    'Email: test@example.com',
    'No contact info'
])

print("原始数据：")
print(texts)

# 提取电话号码
phones = texts.str.extract(r'(\d{3}-\d{4}-\d{4})')
print("\n提取电话号码：")
print(phones)

# 检查是否匹配模式
has_phone = texts.str.match(r'Phone:.*')
print("\n包含电话：")
print(has_phone)

# 替换（正则）
cleaned = texts.str.replace(r'\d{3}-\d{4}-\d{4}', '***-****-****', regex=True)
print("\n脱敏后：")
print(cleaned)
```

## 15.4 字符串方法链式调用

```python
# 创建需要清洗的数据
messy_data = pd.Series([
    '  PRODUCT-A  ',
    'product-b   ',
    '  Product-C',
    'PRODUCT-D'
])

print("原始数据：")
print(messy_data)

# 链式清洗
cleaned = (messy_data
          .str.strip()
          .str.lower()
          .str.replace('-', '_'))

print("\n清洗后：")
print(cleaned)
```

## 15.5 实战案例：文本数据清洗

```python
# 电商数据清洗
products = pd.DataFrame({
    'Name': ['  iPhone 14 Pro  ', 'SAMSUNG Galaxy S23', 'xiaomi 13 pro'],
    'Price': ['¥8999', '¥7999', '¥4999'],
    'Description': ['Latest model!!!', 'Best seller   ', 'HOT SALE!!!']
})

print("原始数据：")
print(products)

# 清洗产品名称
products['Name_Clean'] = (products['Name']
                         .str.strip()
                         .str.title())

# 提取价格数字
products['Price_Numeric'] = products['Price'].str.extract(r'(\d+)').astype(int)

# 清理描述
products['Description_Clean'] = (products['Description']
                                .str.strip()
                                .str.replace('!+', '', regex=True)
                                .str.capitalize())

print("\n清洗后：")
print(products)
```
